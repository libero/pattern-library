sudo: required

language: minimal

services: docker

script:
    # conventional image name, but no intention to push it so far
    - docker build -t liberoadmin/patterns-core .

after_success:
    - docker run --name patterns-core liberoadmin/patterns-core node_modules/.bin/gulp exportPatterns
    # TODO: empty out committed export/ folder
    - docker cp patterns-core:/patterns-core/export/. export/
    - .travis/package.sh

deploy:
  provider: releases
  api_key:
    # Github token from user `liberoadmin` with `public_repo` scope
    secure: "IxdUbp6XL7DqyBq6pHGOQ1gE+SJ0S7HdVflsOA/0vC0lh7PfHUry2zrgSUwATQjSqBAU8ySEUi+IutKfDHno8ihJpZniqRgr2BN26eewB10xdMxcr4iCs4zmOAomhp5y9IRl6nAU2kyQI4TigGHmBTtHcSf5ZM7pgf7dEIEdGnifi+ZmGtwtpfOKe50dFX4bhdbCBkEEtEQqyqH1NjTXYb3s5MPEkczOh0ZJNwgq8z3WOa2s2iB3qiha27F3U4nYfpCExOv0bov7OSTnTpwjE4ofvoU2qHqP70Ku9l8urxP2spFghkRpewSKNPIOh4bsIS0R8Geyq2rEYAsZB/J1wMuFEGg+swNrTEffcqAW7JnsmZ3DDqefVY5IY3Z1gU0g7Vqj25UoeaVUU5807WDr9R14C60QZOFYoGONCXkrltDo97tBLZI5ZqPTabXJL/3ng6T4lqxXl2euELEAeec/prN2LBGzNxrfB5d8OSO1mQoTjTQ01WF59vqCZF9nlUdUFE1OTG8/zwX/VxGvSGfRhxoZLqQw57WOyZWe1FfAGItnyJN+xCsgeORPUSGo9obteuVgRVrPSkPIBSsr21Zvf3GYfTXYRyLaWBdxSIPj9toi1wRklDzJ5Sax6PIlP5KifWtxu9nOAe8LR3o1as6W23GlxB6AGU+se/VtDsge+4k="
  file: "patterns-core-${TRAVIS_TAG}.tar.gz"
  skip_cleanup: true
  on:
    tags: true

if: |
    branch = master OR \
    branch =~ /^[0-9\.]+$/ OR \
    tag IS present OR \
    type = pull_request
